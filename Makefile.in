name=bdsim
G4TARGET=$(name)
G4EXLIB=true

G4WORKDIR=@BINDIR@
G4INSTALL=@G4INSTALL@
ROOTSYS=@ROOTSYS@
G4VERSION=@G4VERSION@

.PHONY: all
all: gmad lib bin

# stuff required for hadronic lists

ifneq ($(G4VERSION), 9)
ifndef G4LISTS_BASE
  EXTRALIBS += -L$(G4LIB)/plists/$(G4SYSTEM)
  G4LISTS_BASE = $(G4INSTALL)/physics_lists
else
  EXTRALIBS += -L$(G4LISTS_BASE)/hadronic/plists/lib/$(G4SYSTEM)
endif

CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/Packaging/include
CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP_LEAD/include
CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/QGSP_BERT/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/QGSP_BIC/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/QGSP_HP/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP_BERT/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP_BERT_HP/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP_BIC/include
#CPPFLAGS += -I$(G4LISTS_BASE)/hadronic/LHEP_BIC_HP/include

#EXTRALIBS += -lQGSP_BERT
#EXTRALIBS += -lQGSP_BIC
#EXTRALIBS += -lQGSP_HP
#EXTRALIBS += -lLHEP_BIC
#EXTRALIBS += -lLHEP_BIC_HP
#EXTRALIBS += -lLHEP_BERT
#EXTRALIBS += -lLHEP_BERT_HP
EXTRALIBS += -lLHEP_LEAD
EXTRALIBS += -lLHEP
EXTRALIBS += -lPackaging
endif

ifneq ($(ROOTSYS),)
ROOTLIBS=`$(ROOTSYS)/bin/root-config --libs`
ROOTCFLAGS=`$(ROOTSYS)/bin/root-config --cflags`
endif

LDLIBS3 += $(ROOTLIBS) 

# standard Geant4 make procedure
include $(G4INSTALL)/config/binmake.gmk


CPPFLAGS += -DG4VERSION=$(G4VERSION) @USE_ROOT@ -DCLHEP_VERSION=@CLHEP_VERSION@
CPPFLAGS += -I./parser
CPPFLAGS += $(ROOTCFLAGS) 
CPPFLAGS += -g -Wall -Wno-non-virtual-dtor -I.

LDFLAGS += -L$(G4LIBDIR) -L./parser -lgmad

ifeq ($(G4SYSTEM),Darwin-g++)
OGLLIBS=@OGLLIBS@
endif

install:

distrib:
	tar --ignore-failed-read -C .. --exclude=BDSIM/parser/parser.tab.* \
	--exclude=BDSIM/parser/lex.* --exclude=BDSIM/parser/libgmad.*\
	--exclude=BDSIM/parser/gmad.o \
	-czvf BDSIM.tar.gz BDSIM/src BDSIM/include \
	BDSIM/bdsim.cc BDSIM/bdsimrun BDSIM/Makefile.in BDSIM/vis.mac \
	BDSIM/configure BDSIM/README BDSIM/examples \
        BDSIM/docs BDSIM/parser \
	BDSIM/examples BDSIM/utils

docs:
	$(MAKE) -C docs

gmad: parser/parser.h parser/parser.y parser/parser.l parser/gmad.h \
        parser/gmad.cc parser/sym_table.h
	@echo "Making gmad parser..."
	@$(MAKE) -C parser

clean:: cleanparser

cleanparser:
	@$(MAKE) -C parser clean

